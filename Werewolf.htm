<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Werewolf</title>
<style type=text/css>

table, button, select, input { 
	font-family: Calibri, Arial, sans-serif;
	font-size: 18px;
}
td {
	padding-right: 15px;
	white-space: nowrap;
}
.info {
	display: inline-block;
	color: dimgray;
	text-decoration: none;
}
.info:hover {
	transform: translate(0px, 0px); 
	font-weight: bold;
	cursor: pointer;
}
.tooltip {
	color: dimgray;
	background: ivory;
	font-style: italic;
    font-weight: normal;
	white-space: normal;
	border: 1px solid;
	border-radius: 4px;
	width: 250;
	position: absolute;
	top:-100%;
	left:10px;
	padding: 5px;
}
</style>
<script>
function load() {
	var option1;
	for (i=6; i<=20; ++i) { 
		option1 = document.createElement("option");
		option1.text =i.toString(); option1.value=i;
		NumberOfPlayers.add(option1, i);
	}
	NumberOfPlayers.selectedIndex=4;

	for (i=0; i<CityRoles.length ; i++) {
		(CityRoles[i][2] ? pCity : pCity2).innerHTML+="&nbsp; <input type=checkbox id=chk_"+CityRoles[i][0]+" onChange=checkboxChange_handler(event) >"+
				CityRoles[i][0]+" <div class=info> ⓘ <div class=tooltip>"+CityRoles[i][3]+"</div></div></br>";
	}
	for (i=0; i<MafiaRoles.length ; i++) {
		(MafiaRoles[i][2] ? pMafia : pMafia2).innerHTML+="&nbsp; <input type=checkbox id=chk_"+MafiaRoles[i][0]+" onChange=checkboxChange_handler(event) >"+
				MafiaRoles[i][0]+" <div class=info> ⓘ <div class=tooltip>"+MafiaRoles[i][3]+"</div></div></br>";
	}
	document.getElementById("chk_"+CityRoles[CityRoles.length-1][0]).disabled=true;
	document.getElementById("chk_"+MafiaRoles[MafiaRoles.length-1][0]).disabled=true;
	setDefaults();
}

function checkboxChange_handler(e) {
	switch(e.target.id) {
		case "chk_Armored": chk_Bulletproof.checked&&=!e.target.checked;
		break;
		case "chk_Bulletproof": chk_Armored.checked&&=!e.target.checked;
		break;
		case "chk_Sniper": chk_Commando.checked&&=!e.target.checked;
		break;
		case "chk_Commando": chk_Sniper.checked&&=!e.target.checked;
		break;
	}
}

function setDefaults() {
	var n_players=NumberOfPlayers.value;
	pTeams.innerText=Math.ceil(2*n_players/3)+" Innocents, "+Math.floor(n_players/3)+" Mafiosi";
	document.querySelectorAll("[id^='chk_']").forEach( item => {
		item.checked=/chk_(Detective|Doctor|Sniper|Citizen|Godfather|Mafioso)/i.test(item.id);
		if (item.id=="chk_Armoured") item.checked=(n_players%3!=2);
		if (item.id=="chk_Godfather") item.checked=(n_players>6);
	});
}

var CityRoles=[
	["Detective", "کارآگاه", true, "At night, the Detective can investigate whether a player is Mafia. (The Godfather appears Innocent when investigated.)"],
	["Doctor", "دکتر", true, "The Doctor protects one (or two) person(s) at night, who will survive any night-time attack. (Doctor's protection doesn't save the players who are died from guilt.)"],
	["Armored", "زره‌پوش", true, "The Armored is invulnerable at night. Besides, if they're chosen to be killed during the daytime, they stay on the game, but lose their power."],
	["Bulletproof", "ضدگلوله", true, "The Bulletproof citizen is invulnerable at night."],
	["Sniper", "تک‌تیرانداز", true, "The Sniper has the ability to shoot at night once (or twice) per game. If they target a mafioso, the target dies, except for the Godfather. Whereas if they target an Innocent, the Sniper dies from guilt. (If they target the Godfather, nobody dies.)"],
	["Commando", "تکاور", true, "Once atteked by the Mafia at night, the Commando is given a chance to shoot. If they target a mafioso, they stay on the game, and their target dies, except for the Godfather. Whereas if they target an Innocent, the Commando dies from guilt. (If they target the Godfather, nobody dies.)"],
	["Gunner", "تفنگ‌دار", false, "..."],
	["Thief", "دزد", false, "The Thief steals the role of another player after the opening day. The player whose role was stolen, gets the Citizen role."],
	["Nurse", "پرستار", false, "The Nurse gains the Doctor's ability if the Doctor dies."],
	["Citizen", "شهروند", true, "Citizens are ordinary Innocent players. Thay can discuss and vote to eliminate players during the daytime."] ];

var MafiaRoles=[
	["Godfather", "رئیس مافیا", true, "The Godfather is the Mafia leader. They appear Innocent to the detective, and are immune to the night-time attaks."],
	["Mafia-Doctor", "دکتر مافیا", false, "The Mafia Doctor can protect a Mafia member from any night-time attack."],
	["Negotiator", "مذاکره کننده", false, "..."],
	["Shaman", "جادوگر", false, "..."],
	["Mafioso", "مافیای ساده", true, "The Mafioso wakes up at night and silently consult their team to pick a victim to be killed."] ];

function go() {
	let n_players=NumberOfPlayers.value;
	let n_mafias=Math.floor(n_players/3);
	let n_citizens=n_players-n_mafias;
	CityRoles.forEach(
		item => item[2]=document.getElementById("chk_"+item[0]).checked );
	MafiaRoles.forEach(
		item => item[2]=document.getElementById("chk_"+item[0]).checked );
//	for (i=0 ; i<CityRoles.length ; ++i)	CityRoles[i][2]=document.getElementById("chk"+i).checked;
//	CityRoles.forEach( (item, index) => p1.innerText+=item[0]+":"+item[2]+"\n");
	var Players=[];
	for (i=0, j=0, l=CityRoles.length-1; i<n_citizens ; i++, j++) {
		if (j<l)
			if (CityRoles[j][2])
				Players.push( {role:CityRoles[j][0]+" - "+CityRoles[j][1], key:Math.random()} );
			else i--;
		else
			Players.push( {role:CityRoles[l][0]+" - "+CityRoles[l][1], key:Math.random()} );
	}
	for (i=0, j=0, l=MafiaRoles.length-1; i<n_mafias ; ++i, j++)
		if (j<l)
			if (MafiaRoles[j][2])
				Players.push( {role:MafiaRoles[j][0]+" - "+MafiaRoles[j][1], key:Math.random()} );
			else --i;
		else
			Players.push( {role:MafiaRoles[l][0]+" - "+MafiaRoles[l][1], key:Math.random()} );
	Players.sort( (a, b) => a.key-b.key );
	p1.innerText="";
	Players.forEach( (item, index) => p1.innerText+=(index+1).toString()+". "+Players[index].role+"\n");
}

function show_hide() {
	if (link.innerText=="More Roles") {
		link.innerText="Less Roles";
		pCity2.style.setProperty("display", "inline");
		pMafia2.style.setProperty("display", "inline");
	}
	else {
		link.innerText="More Roles";
		pCity2.style.setProperty("display", "none");
		pMafia2.style.setProperty("display", "none");
	}
}
</script>
</head>

<body onLoad="load()">
<table><tr valign=top>
	<td>
	Number of players:
	<select id=NumberOfPlayers onChange="setDefaults()"></select>
	<button onclick="go()">Go!</button><br>
    <i id=pTeams></i>
	<p id=p1></p>
	</td>
	<td>
	<div id=pCity><b>City Roles:</b><br></div>
	<div id=pCity2 style="display:none;"></div><br>
    
	<div id=pMafia><b>Mafia Roles:</b><br></div>
	<div id=pMafia2 style="display:none;"></div><br>
	<a href="javascript:setDefaults();">Defaults</a>&nbsp;&nbsp;
	<a id=link href="javascript:show_hide();">More Roles</a>
	</td>
</tr></table>

<a id=pTest href="https://en.wikipedia.org/wiki/Mafia_(party_game)" style="text-decoration:none;">シ</a>
</body>
</html>